<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>J.A.R.V.I.S HUD</title>
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: "Orbitron", sans-serif;
      color: cyan;
    }

    .hud {
      position: relative;
      width: 400px;
      height: 400px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* glowing rings */
    .ring {
      position: absolute;
      border: 2px solid cyan;
      border-radius: 50%;
      animation: spin 10s linear infinite;
      opacity: 0.6;
    }
    .ring:nth-child(1) { width: 400px; height: 400px; animation-duration: 12s; }
    .ring:nth-child(2) { width: 300px; height: 300px; animation-duration: 8s; }
    .ring:nth-child(3) { width: 200px; height: 200px; animation-duration: 5s; }
    .ring:nth-child(4) { width: 100px; height: 100px; animation-duration: 3s; }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .center-text {
      position: absolute;
      text-align: center;
      font-size: 22px;
      text-shadow: 0 0 10px cyan, 0 0 20px cyan;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 10;   /* ✅ always on top */
   }

    .listening {
      color: lime;
      text-shadow: 0 0 15px lime, 0 0 30px lime;
    }

    .log {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      max-height: 200px;
      overflow-y: auto;
      text-align: left;
      font-size: 14px;
      line-height: 1.5;
      color: #0ff;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 8px;
      border: 1px solid cyan;
      z-index: 5;    /* ✅ stays behind center text */
   }

    .user { color: #6cf; }
    .jarvis { color: #0f0; }
    .error { color: #f55; }
  </style>
</head>
<body>
  <div class="hud">
    <div class="ring"></div>
    <div class="ring"></div>
    <div class="ring"></div>
    <div class="ring"></div>
    <div class="center-text">CLICK TO SPEAK</div>
    <div class="log" id="log"></div>
  </div>

  <script>
    async function sendCommand(command) {
      try {
        const response = await fetch("/command", {   // ✅ no hardcoded URL
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text: command })
        });
        const data = await response.json();
        
        // Show in log
        logMessage("🗣 You: " + command, "user");
        logMessage("🤖 Jarvis: " + data.response, "jarvis");

        // Speak response
        const utterance = new SpeechSynthesisUtterance(data.response);
        speechSynthesis.speak(utterance);

      } catch (err) {
        logMessage("❌ Error connecting to backend", "error");
        console.error(err);
      }
    }

    function logMessage(msg, cls="") {
      const logDiv = document.getElementById("log");
      const line = document.createElement("div");
      line.className = cls;
      line.textContent = msg;
      logDiv.appendChild(line);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function startListening() {
      const recognition = new(window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.start();

      recognition.onresult = function(event) {
        const command = event.results[0][0].transcript;
        document.querySelector(".center-text").textContent = "⏳ Processing...";
        sendCommand(command);
      };

      recognition.onerror = function(event) {
        document.querySelector(".center-text").textContent = "Error listening";
        logMessage("⚠️ Speech recognition error: " + event.error, "error");
      };

      recognition.onend = function() {
        document.querySelector(".center-text").textContent = "CLICK TO SPEAK";
        document.querySelector(".center-text").classList.remove("listening");
      };
    }

    document.querySelector(".center-text").addEventListener("click", () => {
      const center = document.querySelector(".center-text");
      center.textContent = "🎤 Listening...";
      center.classList.add("listening");
      startListening();
    });
  </script>
</body>
</html>
